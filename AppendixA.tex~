\documentclass[main.tex]{subfiles}
\begin{document}
\glsresetall

\section{Introduction}

IACT's work detecting the Cherenkov light porduced by the interaction of gamma rays and other particles in the
atmosphere. This cherenkov photons must be distinguished from those of the Night Sky Background (NSB) that fill
the atmosphere. Telescopes are constantly receiving light from NSB, that could produce events in the detector,
together with the light produced by cherenkov showers. It is necessary to have a trigger system that analyzes
the incoming light and takes the decision of storing the data of the showers and rejects the NSB events.\\
Usually this task is made by recognizing a concentration of signal from several pixels both in space and time.
Showers are produced in a time window of a few nanoseconds, giving signal to a group of near pixels, while NSB light
is randomly distributed. Only when this coincidence of signal in time and space is produced, the trigger gives the
instruction of storing the data.\\

There are two possible approaches for this detection of coincident light used in IACT's, called
``majority trigger'' or ``sum trigger''. In majority trigger the light of each pixel is compared to a certain
threshold. If the signal of several (the majority of) pixels in a certain region exceeds the threshold in a brief time,
then the trigger is fired. This approach presents a disadvantage when detecting low energy photon showers,
as happens in LST. The problem is that as the pixels must overcome the threshold individually, if the signal
is too low, it's possible  that some of them won't exceed the threshold and therefore the event would be missleaded as a NSB event.\\

On the other hand, the sum trigger approach takes into account the signal coming to a group of several pixels.
The light arriving to each pixel of the group is added and is this addition which must surpass a certain threshold to
fire the trigger. If several close group of pixels surpass the threshold at a given time window, then
the event is recorded as a shower event.\\

In the LST, a multilevel trigger system is used, that guarantees the rejection of the majority of the NSB light and
satisfies the sensitivity required.\\

LST cameras have been designed to be modular  for several reasons of assembly and maintenance convenience. The pixels
in the camera are distibuted in 265 hexagonal modules of 7 pixels, that are connected to each of it's 6 neighbours.
The first trigger level (L0) sums the signal of the pixels in each module, and if it is significative, a trigger signal
is sent to the neighbours. In the second trigger level (L1), each module takes the trigger signal coming from its neighbours and
compares it to a threshold to decide if the camera trigger is fired. Finally, the third level compares the camera trigger of
several telescopes and if two or more telescopes have triggered in a certain time window, the event is recorded. \\

\begin{figure}
  \centering
  \includegraphics[width=\textwidth]{./Pictures/triggerscheme.pdf}
  % L1blockdiagram.png: 1296x675 pixel, 72dpi, 45.72x23.81 cm, bb=0 0 1296 675
  \caption{Architecture of the analog trigger system}
  \label{fig:trigger}
\end{figure}


\subsection{Pixel Level: L0 trigger decision}

The pixel level, dubbed for CTA as L0, takes into account the signals from the pixels in one module or cluster. If the trigger is fired,
the signal is distributed by the L0 fan out to the local L1 and to the neighbours.
Both, the majority and sum trigger approaches have been developed for  being used at the L0 trigger.

\subsubsection{Majority}

As explained before, the majority approach counts the number of pixels in a module that have a signal over a certain threshold voltage.
When this happens, a digital signal is generated. The signal from all the pixels is added, resulting in a final signal with amplitude
proportional to the number of activated pixels, that goes to the local L1 and the neighbour modules. This approach doesn't accounts for the number of photoelectrons that activated each pixel,
only for the number of pixels that have surpassed the threshold. This means that even if a large number of pixels in a region receives
a flash of light, if in each pixel the amount of photoelectrons is not enough, the event would be considered NSB and not recorded,
limiting the capacity of detecting low energy events.

\subsubsection{Sum}

The sum trigger adds the signal received in each pixel of the module and the resulting signal is compared with a threshold voltage. If
the threshold is surpassed, the signal is sent to local and neighbours' L1. This way makes it possible to take into account the contributions
of all pixels of the module, being able to reject NSB but also to improve the detection of low energy events. After adding the signals
of all pixels a clipping is applied to overcome afterpulse effects in the photomultipliers. Afterpulses are sometimes produced after a real pulse
in the photosensors, due to the ionization of residual gases, and can contribute with a very high amplitude to the sum.

\subsubsection{L0 Fan-out}

The L0 signal must be distributed to the local L1 and the L1 of the neighbours. The L0 signal of each module is replicated seven times,
one of them is sent to the local L1 and the rest to the neighbouring modules.

\subsection{Camera Level: L1 trigger decision}

Camera level trigger decision system, in CTA named L1, analogically adds the resulting signals of L0 trigger from neighbouring modules and compares
the result with a threshold voltage. If the analog sum is over the threshold, a signal is sent to the L1 distribution to trigger
the camera.
Each module has six neighbours from which it receives the L0 signals from L0 fan-out, plus the local L0, there are seven
signals that can be combined. To ensure that all modules are paricipating in the trigger and addings are made in an efficient way, it is possible
to configure by slow control different modes where intelligent configurations of neighbouring signals are added. In figure~\ref{fig:trigmodes} the three modes,
named 2, 3 and 4, are shown. This configurations make it possible, through combinations of two, three or four modules, to evaluate
any trigger region.

\begin{figure}
  \centering
    \includegraphics[width=\textwidth]{./Pictures/triggermodes.pdf}
    \caption{Illustration of the three possible modes for adding signals of neighbouring modules. Each hexagon represents a group of seven photomultipliers.}
    \label{fig:trigmodes}
\end{figure}

\subsubsection{L1 Trigger Distribution}

The L1 trigger distribution system allows the L1 signal to reach the data adquisition systems of all the modules and start the digitalizing
process. Every module can send the L1 signal to its six neighbours, and is awatred of its position in the camera. This way, when a module receives
a L1 signal, it can be delayed depending on the position in the camera and be sent to the appropriate neighbours following the preconfigured paths. (See figure ~\ref{fig:trigpaths}). The distribution paths are firmware configurable and they can automatically be reconfigured to go through the full
camera, even if for some reason one module is malfunctioning.

\begin{figure}
  \centering
  \includegraphics[width=\textwidth]{./Pictures/triggerpaths.pdf}
  % L1blockdiagram.png: 1296x675 pixel, 72dpi, 45.72x23.81 cm, bb=0 0 1296 675
  \caption{Paths for trigger distribution over the entire camera.}
  \label{fig:trigpaths}
\end{figure}

\subsection{Array Level trigger decision}
Array level trigger looks for coincidences in events recorded by several telescopes. If more than one telescope has a camera trigger in
a certain time window, it is likely that the light is produced by a cherenkov shower, so the data is stored. This level allows to reject
the majority of NSB events that have overcomed the lower level triggers.

\end{document}
